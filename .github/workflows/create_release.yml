name: Build & Release Android

on:
  push:
    branches: [ master ]
    paths:
      - "**/workflows-trigger.properties"

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: checkout code
        uses: actions/checkout@v6

      - name: setup jdk
        uses: actions/setup-java@v5
        with:
          java-version: "21"
          distribution: "zulu"
          cache: "gradle"

      - name: grant execute permission for gradlew
        run: chmod +x gradlew

      - name: assembleRelease
        run: ./gradlew assembleRelease

      - name: get current time
        uses: josStorer/get-current-time@v2
        id: time
        with:
          format: YYYY.MM.DD
          utcOffset: "+08:00"

      - name: create github release
        uses: ncipollo/release-action@v1
        with:
          allowUpdates: true
          generateReleaseNotes: false
          artifactErrorsFailBuild: true
          body: "Auto-generated release from GitHub Actions."
          artifacts: "app/build/outputs/apk/release/*.apk"
          tag: ${{steps.time.outputs.formattedTime}}
          name: ${{steps.time.outputs.formattedTime}}
          token: ${{secrets.GITHUB_TOKEN}}